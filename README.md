# Тестовое задание для Python-разработчика

## Описание проекта
Проект представляет собой API для работы с каталогом товаров. Он включает функционал для управления товарами и их свойствами, а также предоставляет возможность фильтрации и поиска товаров.

---

## Структура проекта

1. **Основные технологии**:
   - Python (3.10+)
   - FastAPI
   - PostgreSQL или SQLite
   - SQLAlchemy

2. **Эндпоинты**:
   - `GET /catalog/` — вывод списка товаров с фильтрацией, поиском и пагинацией.
   - `GET /catalog/filter/` — сбор статистики для фильтрации товаров.
   - `GET /product/{UID}` — информация о конкретном товаре.
   - `POST /product/` — создание нового товара.
   - `DELETE /product/{UID}` — удаление товара.
   - `POST /properties/` — добавление нового свойства.
   - `DELETE /properties/{UID}` — удаление свойства.

---

## Установка и запуск
Клонируйте данный репозиторий к себе на локальную машину: git clone https://github.com/valyaplotnikova/Catalog_API.git

В файлах .env.example подставьте свои переменные окружения и переименуйте файлы в .env
### 1. Установка зависимостей
Для установки зависимостей используйте `pip`. Убедитесь, что у вас установлен Python версии 3.10 или выше.

```bash
# Создайте виртуальное окружение
python3 -m venv venv
source venv/bin/activate

# Установите зависимости
pip install -r requirements.txt
```
---

### 2. Настройка базы данных

#### Для PostgreSQL:
1. Создайте базу данных в PostgreSQL:
   ```bash
   sudo -u postgres psql
   CREATE DATABASE catalog;
   ```

2. Настройте подключение к базе данных в файле `.env`:
  


### 3. Применение миграций
Используйте Alembic для создания и применения миграций:

```bash
# Инициализация Alembic
alembic init alembic

# Настройка конфигурации Alembic (файл alembic.ini)
# Укажите sqlalchemy.url в секции [alembic]

# Создание миграции
alembic revision --autogenerate -m "Initial migration"

# Применение миграции
alembic upgrade head
```

---

### 4. Запуск приложения
Запустите приложение с помощью Uvicorn:

```bash
uvicorn main:app --reload
```

Приложение будет доступно по адресу `http://127.0.0.1:8000`.

---

## Использование API

### 1. `GET /catalog/`
Возвращает список товаров с возможностью фильтрации, поиска и пагинации.

**Пример запроса**:
```
GET /catalog/?name=abc&property_uid1=uid1&property_uid1=uid2&property_uid2=uid3
```

**Пример ответа**:
```json
{
  "products": [
    {
      "uid": "uid1",
      "name": "Товар 1",
      "properties": [
        {"uid": "uid1", "value_uid": "uid1", "value": "Значение 1"},
        {"uid": "uid3", "value": 15}
      ]
    }
  ],
  "count": 50
}
```

---

### 2. `GET /catalog/filter/`
Возвращает статистику для фильтрации товаров.

**Пример запроса**:
```
GET /catalog/filter/?property_uid1=uid1
```

**Пример ответа**:
```json
{
  "count": 35,
  "property_uid1": {"uid1": 10, "uid2": 15},
  "property_uid2": {"uid3": 2},
  "property_uid4": {"min_value": 15, "max_value": 20}
}
```

---

### 3. `GET /product/{UID}`
Возвращает информацию о конкретном товаре.

**Пример запроса**:
```
GET /product/uid1
```

**Пример ответа**:
```json
{
  "uid": "uid1",
  "name": "Товар 1",
  "properties": [
    {"uid": "uid1", "value_uid": "uid1", "value": "Значение 1"},
    {"uid": "uid3", "value": 15}
  ]
}
```

---

### 4. `POST /product/`
Создает новый товар.

**Пример запроса**:
```json
{
  "uid": "uid1",
  "name": "Товар 1",
  "properties": [
    {"uid": "uid1", "value_uid": "uid1"},
    {"uid": "uid3", "value": 15}
  ]
}
```

---

### 5. `DELETE /product/{UID}`
Удаляет товар.

**Пример запроса**:
```
DELETE /product/uid1
```

---

### 6. `POST /properties/`
Добавляет новое свойство.

**Пример запроса**:
```json
{
  "uid": "uid1",
  "name": "Свойство 1",
  "type": "list",
  "values": [
    {"value_uid": "uid1", "value": "Значение 1"},
    {"value_uid": "uid2", "value": "Значение 2"}
  ]
}
```

---

### 7. `DELETE /properties/{UID}`
Удаляет свойство.

**Пример запроса**:
```
DELETE /properties/uid1
```

---

## Дополнительные материалы

1. **Тестовые данные**:
   - Файл `data.json` содержит примеры товаров и их свойств.

2. **Логирование**:
   - Логи записываются в файл `app.log` для отслеживания ошибок и событий.

3. **Документация API**:
   - Swagger UI доступен по адресу `http://127.0.0.1:8000/docs`.

---

## Важные замечания

1. Убедитесь, что все зависимости установлены корректно.
2. При возникновении проблем с базой данных проверьте настройки подключения в `.env`.
3. Если вы используете SQLite, убедитесь, что файл базы данных доступен для записи.

---
